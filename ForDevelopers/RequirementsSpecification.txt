# 汎用ドキュメント検索・要約エージェント

## 要件定義書 v1.2（Reactフロントエンド構成版）

作成日：2025-12-04
作成者：飯田吏雄
版数：1.2

※v1.1 をベースに、フロントエンドを React 化し、フロント／バック分離構成を前提とした改定版。

---

## 1. システム概要

### 1.1 システム名（仮）

汎用ドキュメント検索・要約エージェント（Generic RAG Agent）

### 1.2 システム概要

ユーザーが自然文で質問を入力すると、あらかじめ登録されたテキスト文書群から関連箇所を検索し、その内容に基づいて LLM が日本語で回答を生成する Web アプリケーション。

* フロントエンド：React を用いた SPA（Single Page Application）
* バックエンド：FastAPI による REST API
* フロントとバックを論理的に分離し、将来的な拡張・デプロイ構成の変更を容易にする。

---

## 2. 前提・制約

### 2.1 技術的前提

* バックエンド

  * 言語：Python 3.11 系
  * フレームワーク：FastAPI
  * ベクトルストア：Chroma などのローカル実行型
  * LLM／Embedding：OpenAI API（例：`gpt-4.1-mini`、`text-embedding-3-small` 相当）

* フロントエンド

  * ライブラリ：React（JavaScript）
  * バンドラ／開発環境：Vite 等のモダンフロントエンドツール（想定）
  * エントリポイント：

    * `src/main.jsx`：React アプリのエントリ
    * `src/App.jsx`：メインコンポーネント
    * `src/App.css`：コンポーネント単位のスタイル
    * `src/index.css`：グローバルスタイル

* フロント／バックの通信

  * HTTP/JSON による REST 通信
  * バックエンド API ルート例：`POST /api/ask`
  * ローカル開発時はポートを分ける（例：フロント：5173、バック：8000）
    → CORS 設定が必要。

### 2.2 運用上の前提

* 利用者は基本的に開発者本人＋少人数のテストユーザー。
* 文書の内容は当面、自分の技術ノート・法務メモ等の低リスクなものを想定。
* デプロイは、バックエンド／フロントエンドを同一ホスト上に置く構成、もしくは別ホスト構成のいずれも許容する。

---

## 3. 利用者・利用シーン

（v1.1 と同様。略）

---

## 4. 機能要件（React 前提への調整）

### 4.1 画面構成（フロントエンド）

* React による単一画面構成（App コンポーネント）

#### 4.1.1 ページ構造

* `App.jsx` の責務

  * 質問入力フォームの表示
  * 送信ボタンの表示・制御
  * API 呼び出し状況（ローディング状態）の表示
  * 回答と参照文書の表示

* スタイル

  * `App.css`：App コンポーネント固有のレイアウト／装飾
  * `index.css`：全体のリセット／共通スタイル

#### 4.1.2 コンポーネント要件（シンプル版）

* `App.jsx`

  * 内部 state：

    * `question`: string（入力中の質問）
    * `answer`: string（APIからの回答）
    * `references`: array（参照文書情報）
    * `isLoading`: boolean（処理中フラグ）
    * `error`: string | null（エラーメッセージ）
  * イベント：

    * 入力欄変更時に `question` を更新
    * 送信ボタンクリック時に `handleSubmit` を実行
  * 振る舞い：

    * `handleSubmit` 内で `/api/ask` に POST
    * レスポンスを `answer` / `references` に格納
    * エラー時は `error` にメッセージを設定

---

### 4.2 バックエンド機能（要点）

バッ クエンド側の機能要件（F-10〜F-20）は v1.1 の内容を維持。
追加・強調点のみ記載する。

* `POST /api/ask`

  * CORS 対応：フロントエンドのオリジン（例：`http://localhost:5173`）からのリクエストを許可。
* JSON I/F 前提：

  * Request: `{ "question": "..." }`
  * Response: `{ "answer": "...", "references": [ { "document_id": "...", "document_title": "...", "snippet": "...", "score": 0.85 }, ... ] }`

---

## 5. 非機能要件（React 前提の加筆）

### 5.1 フロント性能・UX

* NFR-F-01：質問送信後、回答が返るまで、ローディング表示（スピナーや「処理中…」など）を行う。
* NFR-F-02：質問・回答欄は PC ブラウザでの利用を前提としたレイアウト（幅 800px 程度を想定）。

### 5.2 開発・ビルド

* NFR-F-03：フロントエンドは、開発時に `npm run dev` 等で起動し、バックエンドとは別ポートで動作する。
* NFR-F-04：本番ビルド（`npm run build`）により静的ファイルを生成し、

  * ① バックエンドとは別の静的ホスティング（例：Vercel）から配信する構成
  * または
  * ② バックエンド側でビルド済みファイルを配信する構成
    のいずれかを選択可能とする（v1 ではどちらか一方を採用すればよい）。

---

## 6. システム構成（概略）

### 6.1 論理構成

* フロントエンド（React SPA）

  * ユーザーのブラウザで動作
  * バックエンド API を呼び出して質問／回答取得を行う

* バックエンド（FastAPI）

  * 文書インデックス／検索／LLM 呼び出しを担当
  * `/api/ask` を提供

* 文書ストレージ／ベクトルストア

  * ローカルファイル＋Chroma などのローカルストア

---

## 7. ディレクトリ構成案

プロジェクトルート直下に、**frontend／backend** を分ける構成とする。

```text
doc-rag-agent/                  # プロジェクトルート
├─ backend/                     # バックエンド（FastAPI）
│  ├─ app/
│  │  ├─ main.py                # FastAPI エントリポイント（/api/ask 定義）
│  │  ├─ config.py              # 設定（モデル名、パスなど）
│  │  └─ rag/                   # RAG 関連モジュール
│  │     ├─ __init__.py
│  │     ├─ document_loader.py  # documents/ からの読み込み
│  │     ├─ index_builder.py    # チャンク生成・Embedding 作成
│  │     ├─ retriever.py        # 類似度検索ロジック
│  │     └─ llm_client.py       # OpenAI API ラッパー
│  │
│  ├─ documents/                # 検索対象文書（.txt / .md など）
│  │  ├─ sample1.txt
│  │  ├─ sample2.txt
│  │  └─ ...
│  │
│  ├─ scripts/
│  │  └─ build_index.py         # 文書→チャンク→ベクトルストア作成スクリプト
│  │
│  ├─ requirements.txt          # Python 依存ライブラリ
│  ├─ .env                      # OpenAI API キーなど（Git 管理外）
│  └─ README.md                 # バックエンド用の簡易説明
│
└─ frontend/                    # フロントエンド（React）
   ├─ index.html                # ルート HTML（Vite 用 / または public 下でも可）
   ├─ package.json              # npm 設定
   ├─ vite.config.js            # Vite 設定ファイル（想定）
   ├─ src/
   │  ├─ main.jsx               # React エントリポイント（root に App をマウント）
   │  ├─ App.jsx                # メイン画面コンポーネント
   │  ├─ App.css                # App コンポーネント専用スタイル
   │  └─ index.css              # グローバルスタイル
   └─ README.md                 # フロントエンド用の簡易説明
```

### 7.1 フロントエンド各ファイルの役割

* `src/main.jsx`

  * `ReactDOM.createRoot` を呼び出し、`<App />` を `#root` にマウントする。
  * `import './index.css'` によりグローバルスタイルを適用。

* `src/App.jsx`

  * 入力欄・ボタン・回答表示部分をまとめたメインコンポーネント。
  * バックエンドの `/api/ask` を呼び出すロジックを持つ。
  * `import './App.css'` によりコンポーネント固有のスタイルを適用。

* `src/App.css`

  * 質問フォームや回答表示のレイアウト・余白・色などを定義。

* `src/index.css`

  * ブラウザデフォルトスタイルのリセットや、フォント等の共通設定を記述。

---

## 8. 受入条件（React 版補足）

* AC-F-01：ローカル環境にて、`backend` と `frontend` をそれぞれ起動し、ブラウザ上の React アプリから質問を送信して回答が取得できること。
* AC-F-02：回答が返るまでの間、React 側でローディング表示が行われること。
* AC-F-03：質問／回答が画面上で正しく表示され、再読み込みなしで複数回の質問に対応できること。
